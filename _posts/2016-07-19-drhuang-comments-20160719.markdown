---  
layout: post  
title: "药师早报 | 安全动态（今日有大事件）"
date: 2016-07-19
categories:  传媒信安     
comments: true
description:  CGI应用漏洞，影响PHP、Go、Python等诸多应用，PHP站长必须关注修复方案。Chrome应用商店发现恶意应用，你中招了没有？
tags:
    - 传媒信安
---  
## CGI应用漏洞，影响PHP、Go、Python等诸多应用

昨天夜里，[httpoxy.org](https://httpoxy.org/)披露了一个隐藏在PHP CGI类应用中至少15年的漏洞（有些人总憋着要搞个大新闻），药师看到这个新闻的时候内心是崩溃的：我们的很多站点都是这个架构方案啊，还让不让人睡觉了啊！该漏洞的成因非常简单粗暴，我推测了一下漏洞形成的历史过程大概是这样的：


1. CGI的早期规范制定者是一个C语言程序员，为了区分从HTTP请求过来的变量名还是CGI服务器上的系统环境变量，采用了C程序设计习惯统一对从HTTP请求过来的参数变量名添加HTTP\_前缀。而对于操作系统上的环境变量名则原汁原味的保留读取。例如：对于一个CGI模式运行的服务端脚本，在获取客户端传送的cookie字段时，是从HTTP\_COOKIE这个CGI程序设置的环境变量中读取的。
2. 众所周知，Linux系统中，大多数程序会读取HTTP\_PROXY这个环境变量（当然，curl和wget读取的是小写的http\_proxy环境变量，感谢Linux系统是区分大小写变量名的，在这次的大事件中这俩哥们幸免于难了）作为发起HTTP请求的本地代理服务器地址。
3. 突然有一天，一个脑洞大开的黑客想到：如果我在HTTP请求头中构造一个Proxy字段，设置该字段值为我控制的一台服务器脚本地址，发送给CGI程序会怎么样呢？bang！CGI程序果然把这个Proxy字段值按照上述第一条处理规则设置为环境变量HTTP\_PROXY了！完美覆盖了系统中原有的HTTP\_PROXY环境变量值！
4. 有什么危害？举一个栗子：如果被请求的这个服务端脚本代码中包含一段HTTP客户端请求代码（很多第三方应用都是这样调用实现的啊，比如：重置找回密码邮件、发送短信验证码、OAuth认证握手过程等），则这段代码会自动将原本的后端机密请求首先发送到HTTP\_RPOXY环境变量设置的代理服务器上！这个代理服务器可是黑客控制的啊！完美中间人攻击啊！验证码、一次性口令直接被发到黑客的服务器上了哦！黑客先看完了再返回给用户的哦！



当然，如果服务应用的接口采用的是https接口，则不受该漏洞影响。原因竟然是因为：CGI程序会把HTTPS请求对应的客户端请求头中的变量名设置为HTTPS\_前缀，从而导致HTTP\_PROXY这个本地环境变量躲过被覆盖控制。

所以，使用HTTPS在无形中减轻了这个漏洞的影响范围啊有木有？

如果你的服务端脚本还是用的http请求，用Nginx+PHP-FPM的小伙伴，只需修改 ``/etc/nginx/fastcgi_params`` ，增加以下一行代码就可以临时修复掉这个漏洞（但同时可能会影响到部分依赖于HTTP_RPOXY这个环境变量的应用）：

```
fastcgi_param HTTP_PROXY "";
```

使用其他CGI方式运行服务器脚本的小伙伴请移步[httpoxy.org](https://httpoxy.org)官网获取漏洞修补方案。

## Chrome应用商店发现恶意应用，你中招了没有？

新闻来源在这里[Malware in the browser: how you might get hacked by a Chrome extension 2016-07-18](https://kjaer.io/extension-malware/)，画面太污，我就不转载原文了。请阅读原文，买票上车。恶意插件的作者充分利用了一小部分猎奇网友的好奇心理，在插件中埋入远程控制代码，实现对中招用户的浏览器中机密数据偷取、控制发动DDoS攻击、刷票、刷粉丝等等。

互联网很好，也不要贪杯哦，小心身体被掏空的同时自己的隐私也被扒干净、电脑也沦为一大波僵尸肉鸡中的一员。