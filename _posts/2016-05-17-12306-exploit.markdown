---  
layout: post  
title: "12306被坑新姿势~~"
date: 2016-05-17
categories:  传媒信安     
comments: true
description: 最近12306又被坑出新姿势了。。。12306网站信任所有证书极易导致中间人攻击，攻击者完全可以控制整个通信内容。
tags:
    - 传媒信安
---  
那些年错过的大雨~~~~

那些年错过的爱情~~~~

![](http://127.0.0.1:4000//resources/images/dd1.jpeg) 

那些年我们错不过的12306~~~~

你还记得吗~~~~

它是这样的。。。

![](http://127.0.0.1:4000//resources/images/dd2.png) 

![](http://127.0.0.1:4000//resources/images/dd3.png) 

![](http://127.0.0.1:4000//resources/images/dd4.png) 

瘫瘫更健康。。。

这样的。。。

![](http://127.0.0.1:4000//resources/images/dd5.png) 

![](http://127.0.0.1:4000//resources/images/dd6.png) 

黑黑更舒畅。。。

and 这样的。。。

![](http://127.0.0.1:4000//resources/images/dd7.png) 

![](http://127.0.0.1:4000//resources/images/dd8.png) 

![](http://127.0.0.1:4000//resources/images/dd9.png) 

瞎瞎太任性~~~~

呜呜~~~~

好想告诉你，告诉你我没有忘记~~~~

然而最近12306又被玩出新姿势了。。。


![](http://127.0.0.1:4000//resources/images/dd10.png) 

12306手机Android APP信任所有证书，极易导致中间人攻击，攻击者完全可以控制整个通信内容。

乌云已公开整个漏洞利用过程：

一、	https未校验证书导致数据被捕获（中间人攻击风险）

客户端虽采用了https，但并未对服务端证书进行校验能够捕获通讯数据，可导致中间人攻击。

![](http://127.0.0.1:4000//resources/images/dd11.png) 


信任所有证书

![](http://127.0.0.1:4000//resources/images/dd12.png) 


![](http://127.0.0.1:4000//resources/images/dd13.png) 


可以正常截获通讯数据

二、通信数据解密

铁路12306通信加解密主要通过checkcode、decheckcode两个函数进行通信加解密，虽然采用加固方式，但是太过依赖于加固技术，从而造成通信接口过于暴露。

dex部分：

![](http://127.0.0.1:4000//resources/images/dd14.png) 


加解密函数代码

![](http://127.0.0.1:4000//resources/images/dd15.png) 

根据加解密函数解密服务器返回数据中的respData数据，解密后的数据:

![](http://127.0.0.1:4000//resources/images/dd16.png) 


可以看到用户手机号、生日、身份证号码、姓名、邮箱、用户名等等信息暴露。

三、数据重放

![](http://127.0.0.1:4000//resources/images/dd17.png) 


登录数据信息重放

![](http://127.0.0.1:4000//resources/images/dd18.png) 


退出之后登录，仍然可以重放登录数据。

解密登录返回数据内容信息：

![](http://127.0.0.1:4000//resources/images/dd19.png) 

重放某人的登录包，可拿到手机号、生日、身份证号码、姓名、邮箱、用户名等等信息。。。

![](http://127.0.0.1:4000//resources/images/dd20.png) 

采用https，却不对服务端证书进行校验！！！！小编也是醉了~~~~

加密算法、通信接口这么容易就暴露了！！！！呜呜，小编也是泪流满面啊~~~~

小编想对12306说：

![](http://127.0.0.1:4000//resources/images/dd21.jpg) 

招黑体质~~~~

小编心疼~~~~

![](http://127.0.0.1:4000//resources/images/dd22.jpg) 

但是，无论如何，请不要放弃自己好吗？

拿着那么多用户的重要数据，责任重大！！！！

安全工作请一定要做好啊！！！！

![](http://127.0.0.1:4000//resources/images/dd23.jpg) 

参考文献：

WooYun：[漏洞标题：铁路12306通信加解密破解](http://www.wooyun.org/bugs/wooyun-2016-0190761)