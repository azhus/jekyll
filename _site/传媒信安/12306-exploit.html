<!DOCTYPE html>
<html lang="en">
<head>
    <title>
        
        12306被坑新姿势~~
        
    </title>
    
    <meta name="description" content="最近12306又被坑出新姿势了。。。12306网站信任所有证书极易导致中间人攻击，攻击者完全可以控制整个通信内容。"/>
    
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="/resources/css/main.css"/>
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"/>
    

    
</head>
<body style="background: url('/resources/images/main_front.jpg') no-repeat fixed;
                            background-size: cover">
<div id="wrapper">
    <header>
    <nav id="main-nav">
        <ul>
            <li><a class="fancy-nav" href="/index.html">home</a></li>
            
            <li><a class="fancy-nav" href="/categories/最新公告">最新公告</a></li>
            
            <li><a class="fancy-nav" href="/categories/传媒信安">传媒信安</a></li>
            
            <li><a class="fancy-nav" href="/categories/课程体系">课程体系</a></li>
            
            <li><a class="fancy-nav" href="/categories/example">example</a></li>
            
            <li><a class="fancy-nav" href="/categories/信息安全科普">信息安全科普</a></li>
            
            <li><a class="fancy-nav" href="/pages/about.html">about</a></li>
        </ul>
    </nav>
</header>

    <main id="start">
        <div class="articles">
            <article>
    <header>
        
        <h1>12306被坑新姿势~~</h1>
        
        <div class="post-meta">
    <small>
        <time datetime="17 05 2016">
            17 May, 2016
        </time>
        <span class="tag-sep"> | </span>
        
        <a class="comment_count" href="/%E4%BC%A0%E5%AA%92%E4%BF%A1%E5%AE%89/12306-exploit#disqus_thread"
           data-disqus-identifier="/%E4%BC%A0%E5%AA%92%E4%BF%A1%E5%AE%89/12306-exploit"></a>
        <span class="tag-sep"> | </span>
        
        <nav class="tags">
    <ul>
        
        <li><a href="/tags/传媒信安.html">传媒信安</a><span>&nbsp;&nbsp;</span></li>
        
    </ul>
</nav>

    </small>
</div>

    </header>
    <p>那些年错过的大雨~~~~</p>

<p>那些年错过的爱情~~~~</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd1.jpeg" alt="" /></p>

<p>那些年我们错不过的12306~~~~</p>

<p>你还记得吗~~~~</p>

<p>它是这样的。。。</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd2.png" alt="" /></p>

<p><img src="http://127.0.0.1:4000//resources/images/dd3.png" alt="" /></p>

<p><img src="http://127.0.0.1:4000//resources/images/dd4.png" alt="" /></p>

<p>瘫瘫更健康。。。</p>

<p>这样的。。。</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd5.png" alt="" /></p>

<p><img src="http://127.0.0.1:4000//resources/images/dd6.png" alt="" /></p>

<p>黑黑更舒畅。。。</p>

<p>and 这样的。。。</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd7.png" alt="" /></p>

<p><img src="http://127.0.0.1:4000//resources/images/dd8.png" alt="" /></p>

<p><img src="http://127.0.0.1:4000//resources/images/dd9.png" alt="" /></p>

<p>瞎瞎太任性~~~~</p>

<p>呜呜~~~~</p>

<p>好想告诉你，告诉你我没有忘记~~~~</p>

<p>然而最近12306又被玩出新姿势了。。。</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd10.png" alt="" /></p>

<p>12306手机Android APP信任所有证书，极易导致中间人攻击，攻击者完全可以控制整个通信内容。</p>

<p>乌云已公开整个漏洞利用过程：</p>

<p>一、	https未校验证书导致数据被捕获（中间人攻击风险）</p>

<p>客户端虽采用了https，但并未对服务端证书进行校验能够捕获通讯数据，可导致中间人攻击。</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd11.png" alt="" /></p>

<p>信任所有证书</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd12.png" alt="" /></p>

<p><img src="http://127.0.0.1:4000//resources/images/dd13.png" alt="" /></p>

<p>可以正常截获通讯数据</p>

<p>二、通信数据解密</p>

<p>铁路12306通信加解密主要通过checkcode、decheckcode两个函数进行通信加解密，虽然采用加固方式，但是太过依赖于加固技术，从而造成通信接口过于暴露。</p>

<p>dex部分：</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd14.png" alt="" /></p>

<p>加解密函数代码</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd15.png" alt="" /></p>

<p>根据加解密函数解密服务器返回数据中的respData数据，解密后的数据:</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd16.png" alt="" /></p>

<p>可以看到用户手机号、生日、身份证号码、姓名、邮箱、用户名等等信息暴露。</p>

<p>三、数据重放</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd17.png" alt="" /></p>

<p>登录数据信息重放</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd18.png" alt="" /></p>

<p>退出之后登录，仍然可以重放登录数据。</p>

<p>解密登录返回数据内容信息：</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd19.png" alt="" /></p>

<p>重放某人的登录包，可拿到手机号、生日、身份证号码、姓名、邮箱、用户名等等信息。。。</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd20.png" alt="" /></p>

<p>采用https，却不对服务端证书进行校验！！！！小编也是醉了~~~~</p>

<p>加密算法、通信接口这么容易就暴露了！！！！呜呜，小编也是泪流满面啊~~~~</p>

<p>小编想对12306说：</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd21.jpg" alt="" /></p>

<p>招黑体质~~~~</p>

<p>小编心疼~~~~</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd22.jpg" alt="" /></p>

<p>但是，无论如何，请不要放弃自己好吗？</p>

<p>拿着那么多用户的重要数据，责任重大！！！！</p>

<p>安全工作请一定要做好啊！！！！</p>

<p><img src="http://127.0.0.1:4000//resources/images/dd23.jpg" alt="" /></p>

<p>参考文献：</p>

<p>WooYun：<a href="http://www.wooyun.org/bugs/wooyun-2016-0190761">漏洞标题：铁路12306通信加解密破解</a></p>

    <footer>
        
        <div id="disqus_thread"></div>
<script>
    /**
     * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    var disqus_developer = 1;
    var disqus_config = function () {
        this.page.url = 'http://localhost:4000/%E4%BC%A0%E5%AA%92%E4%BF%A1%E5%AE%89/12306-exploit';
        this.page.identifier = '/%E4%BC%A0%E5%AA%92%E4%BF%A1%E5%AE%89/12306-exploit';
        this.page.title = "12306被坑新姿势~~";
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//.disqus.com/embed.js';

        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        
    </footer>
</article>

        </div>
    </main>
        <nav class="paginator">
    <ul>
        
        
        <li><a class="fancy-nav" href="/%E4%BC%A0%E5%AA%92%E4%BF%A1%E5%AE%89/Who-Am-I">&lt;&nbsp;Previous</a></li>
        
        <li class="sep">&nbsp;</li>
        <li><a class="fancy-nav" href="#">Top</a></li>
        <li class="sep">&nbsp;</li>
        
        <li><a class="fancy-nav" href="/%E4%BC%A0%E5%AA%92%E4%BF%A1%E5%AE%89/news-search">Next&nbsp;&gt;</a></li>
        
        
    </ul>
</nav>

    <footer>
        
<blockquote id="footer-quote">
    <p>
        
        Some fancy quote
        
    </p>
    <footer>
        <cite>
        
        - John Doe
        
    </cite>
    </footer>
</blockquote>

<div id="footer-main">
    <small>
        &copy; 2016 Name Surname. ALL RIGHTS RESERVED.
    </small>
</div>

    </footer>
</div>

</body>
</html>
